#!/bin/bash

PHP_INI_PATH=${PHP_INI_PATH:-/opt/app-root/etc/php.ini}

while IFS='=' read -r name value ; do
  if [[ $name == 'PHPINI_'* ]]; then
    name="${name/PHPINI_/}"
    name="${name,,}"
    name="${name/__/\.}"
    sed -i "/$name[ =].*/d" $PHP_INI_PATH
    if [ "$value" != "" ]
    then
      echo "$name = $value " >> $PHP_INI_PATH
    fi
  fi
done < <(env)